<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2657px" preserveAspectRatio="none" style="width:3128px;height:2657px;background:#FFFFFF;" version="1.1" viewBox="0 0 3128 2657" width="3128px" zoomAndPan="magnify"><defs><filter height="300%" id="f171c6zi8kskl4" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f171c6zi8kskl4)" height="2481.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="72.5" y="98.4297"/><rect fill="#FFFFFF" filter="url(#f171c6zi8kskl4)" height="74.4297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="459.5" y="311.3594"/><rect fill="#FFFFFF" filter="url(#f171c6zi8kskl4)" height="2164.8594" style="stroke:#A80036;stroke-width:1.0;" width="10" x="683" y="414.9219"/><rect fill="#FFFFFF" filter="url(#f171c6zi8kskl4)" height="2481.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="930" y="98.4297"/><rect fill="#FFFF00" filter="url(#f171c6zi8kskl4)" height="2465.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1185" y="98.4297"/><rect fill="#FFFFFF" filter="url(#f171c6zi8kskl4)" height="2481.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1676" y="98.4297"/><rect fill="#FFFFFF" filter="url(#f171c6zi8kskl4)" height="103.5625" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2072" y="1051.8438"/><rect fill="#FFFFFF" filter="url(#f171c6zi8kskl4)" height="35.2969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2272" y="1090.9766"/><rect fill="#FFFFFF" filter="url(#f171c6zi8kskl4)" height="1424.375" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2272" y="1155.4063"/><rect fill="#FFFFFF" filter="url(#f171c6zi8kskl4)" height="1149.6133" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2501" y="1430.168"/><rect fill="#FFFFFF" filter="url(#f171c6zi8kskl4)" height="963.8164" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2755" y="1615.9648"/><rect fill="#FFFFFF" filter="url(#f171c6zi8kskl4)" height="2481.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3078" y="98.4297"/><rect fill="#FFFFFF" filter="url(#f171c6zi8kskl4)" height="59.2656" style="stroke:#000000;stroke-width:2.0;" width="339" x="2404" y="1457.7344"/><rect fill="#FFFFFF" filter="url(#f171c6zi8kskl4)" height="59.2656" style="stroke:#000000;stroke-width:2.0;" width="320.5" x="2676.5" y="1643.5313"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="77" x2="77" y1="67.2969" y2="2588.7813"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="464" x2="464" y1="67.2969" y2="2588.7813"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="687.5" x2="687.5" y1="352.0078" y2="2588.7813"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="934.5" x2="934.5" y1="67.2969" y2="2588.7813"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1190" x2="1190" y1="67.2969" y2="2588.7813"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1464" x2="1464" y1="67.2969" y2="2588.7813"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1681" x2="1681" y1="67.2969" y2="2588.7813"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="2077" x2="2077" y1="67.2969" y2="2588.7813"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="2277" x2="2277" y1="1092.4922" y2="2588.7813"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="2506" x2="2506" y1="67.2969" y2="2588.7813"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="2759.5" x2="2759.5" y1="67.2969" y2="2588.7813"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="3083" x2="3083" y1="67.2969" y2="2588.7813"/><rect fill="#ADD8E6" filter="url(#f171c6zi8kskl4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="141" x="5" y="32"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127" x="12" y="51.9951">ClientPresentation</text><rect fill="#ADD8E6" filter="url(#f171c6zi8kskl4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="141" x="5" y="2587.7813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127" x="12" y="2607.7764">ClientPresentation</text><rect fill="#ADD8E6" filter="url(#f171c6zi8kskl4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="145" x="390" y="32"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="131" x="397" y="51.9951">CommandFactoryC</text><rect fill="#ADD8E6" filter="url(#f171c6zi8kskl4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="145" x="390" y="2587.7813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="131" x="397" y="2607.7764">CommandFactoryC</text><rect fill="#ADD8E6" filter="url(#f171c6zi8kskl4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="91" x="640.5" y="2587.7813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77" x="647.5" y="2607.7764">BuyGameC</text><rect fill="#ADD8E6" filter="url(#f171c6zi8kskl4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="183" x="841.5" y="32"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="169" x="848.5" y="51.9951">NetworkStreamHandlerC</text><rect fill="#ADD8E6" filter="url(#f171c6zi8kskl4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="183" x="841.5" y="2587.7813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="169" x="848.5" y="2607.7764">NetworkStreamHandlerC</text><rect fill="#FFFFE0" filter="url(#f171c6zi8kskl4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="120" x="1128" y="32"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106" x="1135" y="51.9951">NetworkStream</text><rect fill="#FFFFE0" filter="url(#f171c6zi8kskl4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="120" x="1128" y="2587.7813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106" x="1135" y="2607.7764">NetworkStream</text><rect fill="#90EE90" filter="url(#f171c6zi8kskl4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="182" x="1371" y="32"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="168" x="1378" y="51.9951">NetworkStreamHandlerS</text><rect fill="#90EE90" filter="url(#f171c6zi8kskl4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="182" x="1371" y="2587.7813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="168" x="1378" y="2607.7764">NetworkStreamHandlerS</text><rect fill="#90EE90" filter="url(#f171c6zi8kskl4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="106" x="1626" y="32"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92" x="1633" y="51.9951">ClientHandler</text><rect fill="#90EE90" filter="url(#f171c6zi8kskl4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="106" x="1626" y="2587.7813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92" x="1633" y="2607.7764">ClientHandler</text><rect fill="#90EE90" filter="url(#f171c6zi8kskl4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="144" x="2003" y="32"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="130" x="2010" y="51.9951">CommandFactoryS</text><rect fill="#90EE90" filter="url(#f171c6zi8kskl4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="144" x="2003" y="2587.7813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="130" x="2010" y="2607.7764">CommandFactoryS</text><rect fill="#90EE90" filter="url(#f171c6zi8kskl4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="90" x="2230" y="2587.7813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="2237" y="2607.7764">BuyGameS</text><rect fill="#90EE90" filter="url(#f171c6zi8kskl4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="180" x="2414" y="32"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="166" x="2421" y="51.9951">BusinessLogicGameInfo</text><rect fill="#90EE90" filter="url(#f171c6zi8kskl4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="180" x="2414" y="2587.7813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="166" x="2421" y="2607.7764">BusinessLogicGameInfo</text><rect fill="#90EE90" filter="url(#f171c6zi8kskl4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="143" x="2686.5" y="32"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="129" x="2693.5" y="51.9951">BusinessLogicUtils</text><rect fill="#90EE90" filter="url(#f171c6zi8kskl4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="143" x="2686.5" y="2587.7813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="129" x="2693.5" y="2607.7764">BusinessLogicUtils</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="3039" y="63.9951">DataAccess</text><path d="M3065,15 C3065,5 3083,5 3083,5 C3083,5 3101,5 3101,15 L3101,41 C3101,51 3083,51 3083,51 C3083,51 3065,51 3065,41 L3065,15 " fill="#90EE90" filter="url(#f171c6zi8kskl4)" style="stroke:#000000;stroke-width:1.5;"/><path d="M3065,15 C3065,25 3083,25 3083,25 C3083,25 3101,25 3101,15 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="3039" y="2600.7764">DataAccess</text><path d="M3065,2614.0781 C3065,2604.0781 3083,2604.0781 3083,2604.0781 C3083,2604.0781 3101,2604.0781 3101,2614.0781 L3101,2640.0781 C3101,2650.0781 3083,2650.0781 3083,2650.0781 C3083,2650.0781 3065,2650.0781 3065,2640.0781 L3065,2614.0781 " fill="#90EE90" filter="url(#f171c6zi8kskl4)" style="stroke:#000000;stroke-width:1.5;"/><path d="M3065,2614.0781 C3065,2624.0781 3083,2624.0781 3083,2624.0781 C3083,2624.0781 3101,2624.0781 3101,2614.0781 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><rect fill="#FFFFFF" filter="url(#f171c6zi8kskl4)" height="2481.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="72.5" y="98.4297"/><rect fill="#FFFFFF" filter="url(#f171c6zi8kskl4)" height="74.4297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="459.5" y="311.3594"/><rect fill="#FFFFFF" filter="url(#f171c6zi8kskl4)" height="2164.8594" style="stroke:#A80036;stroke-width:1.0;" width="10" x="683" y="414.9219"/><rect fill="#FFFFFF" filter="url(#f171c6zi8kskl4)" height="2481.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="930" y="98.4297"/><rect fill="#FFFF00" filter="url(#f171c6zi8kskl4)" height="2465.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1185" y="98.4297"/><rect fill="#FFFFFF" filter="url(#f171c6zi8kskl4)" height="2481.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1676" y="98.4297"/><rect fill="#FFFFFF" filter="url(#f171c6zi8kskl4)" height="103.5625" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2072" y="1051.8438"/><rect fill="#FFFFFF" filter="url(#f171c6zi8kskl4)" height="35.2969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2272" y="1090.9766"/><rect fill="#FFFFFF" filter="url(#f171c6zi8kskl4)" height="1424.375" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2272" y="1155.4063"/><rect fill="#FFFFFF" filter="url(#f171c6zi8kskl4)" height="1149.6133" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2501" y="1430.168"/><rect fill="#FFFFFF" filter="url(#f171c6zi8kskl4)" height="963.8164" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2755" y="1615.9648"/><rect fill="#FFFFFF" filter="url(#f171c6zi8kskl4)" height="2481.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3078" y="98.4297"/><polygon fill="#A80036" points="918,94.4297,928,98.4297,918,102.4297,922,98.4297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="82.5" x2="924" y1="98.4297" y2="98.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="372" x="89.5" y="93.3638">new NetworkStreamHandler(tcpClient.GetStream()); : void</text><polygon fill="#A80036" points="1475,123.5625,1465,127.5625,1475,131.5625,1471,127.5625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1469" x2="1675" y1="127.5625" y2="127.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="1481" y="122.4966">ReadCommand() : Command</text><polygon fill="#A80036" points="1206,165.2617,1196,169.2617,1206,173.2617,1202,169.2617" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1200" x2="1463" y1="169.2617" y2="169.2617"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="1212" y="164.1958">Read(CMD_LENGTH) : byte[]</text><path d="M1469,140.5625 L1469,180.5625 L1701,180.5625 L1701,150.5625 L1691,140.5625 L1469,140.5625 " fill="#FBFB77" filter="url(#f171c6zi8kskl4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1691,140.5625 L1691,150.5625 L1701,150.5625 L1691,140.5625 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="1475" y="157.6294">Esto se realiza cuando</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="1475" y="172.7622">se crea la conexión con el cliente</text><line style="stroke:#A80036;stroke-width:1.0;" x1="82.5" x2="124.5" y1="210.9609" y2="210.9609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="124.5" x2="124.5" y1="210.9609" y2="223.9609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="83.5" x2="124.5" y1="223.9609" y2="223.9609"/><polygon fill="#A80036" points="93.5,219.9609,83.5,223.9609,93.5,227.9609,89.5,223.9609" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="89.5" y="205.895">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159" x="102.5" y="205.895">BuyGame(gameId) : void</text><polygon fill="#A80036" points="1475,249.0938,1465,253.0938,1475,257.0938,1471,253.0938" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1469" x2="1675" y1="253.0938" y2="253.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="1481" y="248.0278">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="1494" y="248.0278">ReadHeader() : string</text><polygon fill="#A80036" points="1206,278.2266,1196,282.2266,1206,286.2266,1202,282.2266" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1200" x2="1463" y1="282.2266" y2="282.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="1212" y="277.1606">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="204" x="1225" y="277.1606">Read(HEADER_LENGTH) : byte[]</text><polygon fill="#A80036" points="447.5,307.3594,457.5,311.3594,447.5,315.3594,451.5,311.3594" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="82.5" x2="453.5" y1="311.3594" y2="311.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="89.5" y="306.2935">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="345" x="102.5" y="306.2935">GetCommandHandler(BUY_GAME, nwsh) : BuyGameC</text><polygon fill="#A80036" points="628.5,336.4922,638.5,340.4922,628.5,344.4922,632.5,340.4922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="469.5" x2="634.5" y1="340.4922" y2="340.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="476.5" y="335.4263">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="489.5" y="335.4263">new BuyGame(nwsh)</text><rect fill="#ADD8E6" filter="url(#f171c6zi8kskl4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="91" x="640.5" y="319.3594"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77" x="647.5" y="339.3545">BuyGameC</text><polygon fill="#A80036" points="93.5,381.7891,83.5,385.7891,93.5,389.7891,89.5,385.7891" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="87.5" x2="463.5" y1="385.7891" y2="385.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="99.5" y="380.7231">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="112.5" y="380.7231">new BuyGameC()</text><polygon fill="#A80036" points="671,410.9219,681,414.9219,671,418.9219,675,414.9219" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="82.5" x2="677" y1="414.9219" y2="414.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="89.5" y="409.856">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="102.5" y="409.856">SendRequest() : GamePage</text><polygon fill="#A80036" points="918,440.0547,928,444.0547,918,448.0547,922,444.0547" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="693" x2="924" y1="444.0547" y2="444.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="700" y="438.9888">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200" x="713" y="438.9888">WriteString(REQUEST_HEADER)</text><polygon fill="#A80036" points="1173,469.1875,1183,473.1875,1173,477.1875,1177,473.1875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="940" x2="1179" y1="473.1875" y2="473.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="947" y="468.1216">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208" x="960" y="468.1216">Write(REQUEST_HEADER: byte[])</text><polygon fill="#A80036" points="1452,498.3203,1462,502.3203,1452,506.3203,1456,502.3203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1195" x2="1458" y1="502.3203" y2="502.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1202" y="497.2544">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="1224" y="497.2544">byte[HEADER_LENGTH]</text><polygon fill="#A80036" points="1664,527.4531,1674,531.4531,1664,535.4531,1668,531.4531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1464" x2="1670" y1="531.4531" y2="531.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1471" y="526.3872">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36" x="1493" y="526.3872">"REQ"</text><polygon fill="#A80036" points="918,556.5859,928,560.5859,918,564.5859,922,560.5859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="693" x2="924" y1="560.5859" y2="560.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="700" y="555.52">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="722" y="555.52">WriteCommand(BUY_GAME)</text><polygon fill="#A80036" points="1173,585.7188,1183,589.7188,1173,593.7188,1177,589.7188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="940" x2="1179" y1="589.7188" y2="589.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="947" y="584.6528">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="969" y="584.6528">Write(data : byte[])</text><polygon fill="#A80036" points="1452,614.8516,1462,618.8516,1452,622.8516,1456,618.8516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1195" x2="1458" y1="618.8516" y2="618.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1202" y="613.7856">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127" x="1224" y="613.7856">byte[CMD_LENGTH]</text><polygon fill="#A80036" points="1664,643.9844,1674,647.9844,1664,651.9844,1668,647.9844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1464" x2="1670" y1="647.9844" y2="647.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1471" y="642.9185">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="1493" y="642.9185">BUY_GAME</text><polygon fill="#A80036" points="918,673.1172,928,677.1172,918,681.1172,922,677.1172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="693" x2="924" y1="677.1172" y2="677.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="700" y="672.0513">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="722" y="672.0513">WriteInt(dataLengthInBytes)</text><polygon fill="#A80036" points="1173,702.25,1183,706.25,1173,710.25,1177,706.25" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="940" x2="1179" y1="706.25" y2="706.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="947" y="701.1841">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="969" y="701.1841">Write(data : byte[])</text><polygon fill="#A80036" points="918,731.3828,928,735.3828,918,739.3828,922,735.3828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="693" x2="924" y1="735.3828" y2="735.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="700" y="730.3169">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="722" y="730.3169">WriteString(data)</text><polygon fill="#A80036" points="1173,773.082,1183,777.082,1173,781.082,1177,777.082" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="940" x2="1179" y1="777.082" y2="777.082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="947" y="772.0161">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="969" y="772.0161">Write(data : byte[])</text><path d="M708,748.3828 L708,788.3828 L921,788.3828 L921,758.3828 L911,748.3828 L708,748.3828 " fill="#FBFB77" filter="url(#f171c6zi8kskl4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M911,748.3828 L911,758.3828 L921,758.3828 L911,748.3828 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="714" y="765.4497">El cliente manda la solicitud y</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="714" y="780.5825">espera leyendo la respuesta</text><polygon fill="#A80036" points="918,814.7813,928,818.7813,918,822.7813,922,818.7813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="693" x2="924" y1="818.7813" y2="818.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="700" y="813.7153">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170" x="722" y="813.7153">ReadInt(HEADER_LENGTH)</text><polygon fill="#A80036" points="1173,843.9141,1183,847.9141,1173,851.9141,1177,847.9141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="940" x2="1179" y1="847.9141" y2="847.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="947" y="842.8481">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="969" y="842.8481">Read(HEADER_LENGTH)</text><polygon fill="#A80036" points="918,873.0469,928,877.0469,918,881.0469,922,877.0469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="693" x2="924" y1="877.0469" y2="877.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="700" y="871.981">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="722" y="871.981">ReadCommand()</text><polygon fill="#A80036" points="1173,902.1797,1183,906.1797,1173,910.1797,1177,906.1797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="940" x2="1179" y1="906.1797" y2="906.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="947" y="901.1138">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="969" y="901.1138">Read(CMD_LENGTH)</text><polygon fill="#A80036" points="918,931.3125,928,935.3125,918,939.3125,922,935.3125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="693" x2="924" y1="935.3125" y2="935.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="700" y="930.2466">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189" x="722" y="930.2466">ReadInt(DATA_SIZE_LENGTH)</text><polygon fill="#A80036" points="1173,960.4453,1183,964.4453,1173,968.4453,1177,964.4453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="940" x2="1179" y1="964.4453" y2="964.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="947" y="959.3794">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="969" y="959.3794">Read(DATA_SIZE_LENGTH)</text><polygon fill="#A80036" points="918,989.5781,928,993.5781,918,997.5781,922,993.5781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="693" x2="924" y1="993.5781" y2="993.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="700" y="988.5122">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="722" y="988.5122">ReadString(dataLength)</text><polygon fill="#A80036" points="1173,1018.7109,1183,1022.7109,1173,1026.7109,1177,1022.7109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="940" x2="1179" y1="1022.7109" y2="1022.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="947" y="1017.645">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="969" y="1017.645">Read(dataLength)</text><polygon fill="#A80036" points="2060,1047.8438,2070,1051.8438,2060,1055.8438,2064,1051.8438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1686" x2="2066" y1="1051.8438" y2="1051.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1693" y="1046.7778">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="345" x="1715" y="1046.7778">GetCommandHandler(BUY_GAME, nwsh) : BuyGameC</text><polygon fill="#A80036" points="2218,1076.9766,2228,1080.9766,2218,1084.9766,2222,1080.9766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2082" x2="2224" y1="1080.9766" y2="1080.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="2089" y="1075.9106">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="2111" y="1075.9106">new BuyGame()</text><rect fill="#90EE90" filter="url(#f171c6zi8kskl4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="90" x="2230" y="1059.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="2237" y="1079.8389">BuyGameS</text><polygon fill="#A80036" points="2093,1122.2734,2083,1126.2734,2093,1130.2734,2089,1126.2734" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2087" x2="2276" y1="1126.2734" y2="1126.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="2099" y="1121.2075">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="2121" y="1121.2075">BuyGameS</text><polygon fill="#A80036" points="2260,1151.4063,2270,1155.4063,2260,1159.4063,2264,1155.4063" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1686" x2="2266" y1="1155.4063" y2="1155.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1693" y="1150.3403">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="1715" y="1150.3403">HandleRequest()</text><polygon fill="#A80036" points="1475,1180.5391,1465,1184.5391,1475,1188.5391,1471,1184.5391" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1469" x2="2271" y1="1184.5391" y2="1184.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1481" y="1179.4731">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189" x="1503" y="1179.4731">ReadInt(DATA_SIZE_LENGTH)</text><polygon fill="#A80036" points="1206,1209.6719,1196,1213.6719,1206,1217.6719,1202,1213.6719" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1200" x2="1463" y1="1213.6719" y2="1213.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1212" y="1208.606">33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="1234" y="1208.606">Read(DATA_SIZE_LENGTH) : byte[]</text><polygon fill="#A80036" points="1452,1238.8047,1462,1242.8047,1452,1246.8047,1456,1242.8047" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1195" x2="1458" y1="1242.8047" y2="1242.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1202" y="1237.7388">34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="1228" y="1237.7388"/><polygon fill="#A80036" points="2260,1267.9375,2270,1271.9375,2260,1275.9375,2264,1271.9375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1464" x2="2266" y1="1271.9375" y2="1271.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1471" y="1266.8716">35</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="1497" y="1266.8716"/><polygon fill="#A80036" points="1475,1297.0703,1465,1301.0703,1475,1305.0703,1471,1301.0703" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1469" x2="2271" y1="1301.0703" y2="1301.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1481" y="1296.0044">36</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="1503" y="1296.0044">ReadString(length)</text><polygon fill="#A80036" points="1206,1326.2031,1196,1330.2031,1206,1334.2031,1202,1330.2031" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1200" x2="1463" y1="1330.2031" y2="1330.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1212" y="1325.1372">37</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="1234" y="1325.1372">Read(length) : byte[]</text><polygon fill="#A80036" points="1452,1355.3359,1462,1359.3359,1452,1363.3359,1456,1359.3359" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1195" x2="1458" y1="1359.3359" y2="1359.3359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1202" y="1354.27">38</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="1228" y="1354.27"/><polygon fill="#A80036" points="2260,1384.4688,2270,1388.4688,2260,1392.4688,2264,1388.4688" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1464" x2="2266" y1="1388.4688" y2="1388.4688"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1471" y="1383.4028">39</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="1497" y="1383.4028"/><polygon fill="#A80036" points="2489,1426.168,2499,1430.168,2489,1434.168,2493,1430.168" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2282" x2="2495" y1="1430.168" y2="1430.168"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="2289" y="1425.1021">40</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="2311" y="1425.1021">&lt;&lt; static &gt;&gt; GetInstance()</text><path d="M2516,1401.4688 L2516,1441.4688 L2689,1441.4688 L2689,1411.4688 L2679,1401.4688 L2516,1401.4688 " fill="#FBFB77" filter="url(#f171c6zi8kskl4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2679,1401.4688 L2679,1411.4688 L2689,1411.4688 L2679,1401.4688 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="2522" y="1418.5356">BusinessLogicGameInfo</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="2522" y="1433.6685">singleton</text><path d="M2404,1457.7344 L2468,1457.7344 L2468,1464.7344 L2458,1474.7344 L2404,1474.7344 L2404,1457.7344 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="59.2656" style="stroke:#000000;stroke-width:2.0;" width="339" x="2404" y="1457.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="2419" y="1470.8013">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="115" x="2483" y="1469.9448">[instance == null]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="2511" x2="2553" y1="1496" y2="1496"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2553" x2="2553" y1="1496" y2="1509"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2512" x2="2553" y1="1509" y2="1509"/><polygon fill="#A80036" points="2522,1505,2512,1509,2522,1513,2518,1509" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="2518" y="1490.9341">41</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="2540" y="1490.9341">new BusinessLogicGameInfo()</text><polygon fill="#A80036" points="2293,1541.1328,2283,1545.1328,2293,1549.1328,2289,1545.1328" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2287" x2="2500" y1="1545.1328" y2="1545.1328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="2299" y="1540.0669">42</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="2325" y="1540.0669"/><polygon fill="#A80036" points="2489,1570.2656,2499,1574.2656,2489,1578.2656,2493,1574.2656" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2282" x2="2495" y1="1574.2656" y2="1574.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="2289" y="1569.1997">43</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="2311" y="1569.1997">BuyGame(gameId,nwsh)</text><polygon fill="#A80036" points="2743,1611.9648,2753,1615.9648,2743,1619.9648,2747,1615.9648" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2511" x2="2749" y1="1615.9648" y2="1615.9648"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="2518" y="1610.8989">44</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="2540" y="1610.8989">&lt;&lt; static &gt;&gt; GetInstance()</text><path d="M2770,1587.2656 L2770,1627.2656 L2909,1627.2656 L2909,1597.2656 L2899,1587.2656 L2770,1587.2656 " fill="#FBFB77" filter="url(#f171c6zi8kskl4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2899,1587.2656 L2899,1597.2656 L2909,1597.2656 L2899,1587.2656 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="2776" y="1604.3325">BusinessLogicUtils</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="2776" y="1619.4653">singleton</text><path d="M2676.5,1643.5313 L2740.5,1643.5313 L2740.5,1650.5313 L2730.5,1660.5313 L2676.5,1660.5313 L2676.5,1643.5313 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="59.2656" style="stroke:#000000;stroke-width:2.0;" width="320.5" x="2676.5" y="1643.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="2691.5" y="1656.5981">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="115" x="2755.5" y="1655.7417">[instance == null]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="2765" x2="2807" y1="1681.7969" y2="1681.7969"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2807" x2="2807" y1="1681.7969" y2="1694.7969"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2766" x2="2807" y1="1694.7969" y2="1694.7969"/><polygon fill="#A80036" points="2776,1690.7969,2766,1694.7969,2776,1698.7969,2772,1694.7969" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="2772" y="1676.731">45</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="2794" y="1676.731">new BusinessLogicGameInfo()</text><polygon fill="#A80036" points="2522,1726.9297,2512,1730.9297,2522,1734.9297,2518,1730.9297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2516" x2="2754" y1="1730.9297" y2="1730.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="2528" y="1725.8638">46</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="2554" y="1725.8638"/><polygon fill="#A80036" points="2743,1756.0625,2753,1760.0625,2743,1764.0625,2747,1760.0625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2511" x2="2749" y1="1760.0625" y2="1760.0625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="2518" y="1754.9966">47</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198" x="2540" y="1754.9966">GetGameById(gameId) : Game</text><polygon fill="#A80036" points="3066,1785.1953,3076,1789.1953,3066,1793.1953,3070,1789.1953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2765" x2="3072" y1="1789.1953" y2="1789.1953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="2772" y="1784.1294">48</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="267" x="2794" y="1784.1294">Games.Find(game.Id == gameId) : Game</text><polygon fill="#A80036" points="2776,1814.3281,2766,1818.3281,2776,1822.3281,2772,1818.3281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2770" x2="3077" y1="1818.3281" y2="1818.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="2782" y="1813.2622">49</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="2808" y="1813.2622"/><polygon fill="#A80036" points="2522,1863.5938,2512,1867.5938,2522,1871.5938,2518,1867.5938" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2516" x2="2754" y1="1867.5938" y2="1867.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="2528" y="1862.5278">50</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="2554" y="1862.5278"/><path d="M2770,1831.3281 L2770,1886.3281 L3093,1886.3281 L3093,1841.3281 L3083,1831.3281 L2770,1831.3281 " fill="#FBFB77" filter="url(#f171c6zi8kskl4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3083,1831.3281 L3083,1841.3281 L3093,1841.3281 L3083,1831.3281 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="296" x="2776" y="1848.395">El dataAcces también cuenta con un singleton</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="302" x="2776" y="1863.5278">Asi todas las businesss logic acceden al mismo</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="297" x="2776" y="1878.6606">Se sacó del diagrama para no agrandarlo más</text><polygon fill="#A80036" points="2743,1912.8594,2753,1916.8594,2743,1920.8594,2747,1916.8594" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2511" x2="2749" y1="1916.8594" y2="1916.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="2518" y="1911.7935">51</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="2540" y="1911.7935">GetUser(nwsh) : User</text><polygon fill="#A80036" points="3066,1941.9922,3076,1945.9922,3066,1949.9922,3070,1945.9922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2765" x2="3072" y1="1945.9922" y2="1945.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="2772" y="1940.9263">52</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="264" x="2794" y="1940.9263">users.Find(game.Id == username) : User</text><polygon fill="#A80036" points="2776,1971.125,2766,1975.125,2776,1979.125,2772,1975.125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2770" x2="3077" y1="1975.125" y2="1975.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="2782" y="1970.0591">53</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="2808" y="1970.0591"/><polygon fill="#A80036" points="2522,2000.2578,2512,2004.2578,2522,2008.2578,2518,2004.2578" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2516" x2="2754" y1="2004.2578" y2="2004.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="2528" y="1999.1919">54</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="2554" y="1999.1919"/><polygon fill="#A80036" points="2293,2029.3906,2283,2033.3906,2293,2037.3906,2289,2033.3906" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2287" x2="2500" y1="2033.3906" y2="2033.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="2299" y="2028.3247">55</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="2321" y="2028.3247">success : bool</text><polygon fill="#A80036" points="1475,2058.5234,1465,2062.5234,1475,2066.5234,1471,2062.5234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1469" x2="2271" y1="2062.5234" y2="2062.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1481" y="2057.4575">56</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="1503" y="2057.4575">WriteString(RESPONSE_HEADER)</text><polygon fill="#A80036" points="1206,2087.6563,1196,2091.6563,1206,2095.6563,1202,2091.6563" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1200" x2="1463" y1="2091.6563" y2="2091.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1212" y="2086.5903">57</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="1234" y="2086.5903">Write(encodedData)</text><polygon fill="#A80036" points="951,2116.7891,941,2120.7891,951,2124.7891,947,2120.7891" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="945" x2="1184" y1="2120.7891" y2="2120.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="957" y="2115.7231">58</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="983" y="2115.7231"/><polygon fill="#A80036" points="704,2145.9219,694,2149.9219,704,2153.9219,700,2149.9219" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="698" x2="929" y1="2149.9219" y2="2149.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="710" y="2144.856">59</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="736" y="2144.856"/><polygon fill="#A80036" points="1475,2175.0547,1465,2179.0547,1475,2183.0547,1471,2179.0547" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1469" x2="2271" y1="2179.0547" y2="2179.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1481" y="2173.9888">60</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="1503" y="2173.9888">WriteCommand(BUY_GAME)</text><polygon fill="#A80036" points="1206,2204.1875,1196,2208.1875,1206,2212.1875,1202,2208.1875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1200" x2="1463" y1="2208.1875" y2="2208.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1212" y="2203.1216">61</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="1234" y="2203.1216">Write(cmd)</text><polygon fill="#A80036" points="951,2233.3203,941,2237.3203,951,2241.3203,947,2237.3203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="945" x2="1184" y1="2237.3203" y2="2237.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="957" y="2232.2544">62</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="983" y="2232.2544"/><polygon fill="#A80036" points="704,2262.4531,694,2266.4531,704,2270.4531,700,2266.4531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="698" x2="929" y1="2266.4531" y2="2266.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="710" y="2261.3872">63</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="736" y="2261.3872"/><polygon fill="#A80036" points="1475,2291.5859,1465,2295.5859,1475,2299.5859,1471,2295.5859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1469" x2="2271" y1="2295.5859" y2="2295.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1481" y="2290.52">64</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="1503" y="2290.52">WriteInt(dataLengthInBytes)</text><polygon fill="#A80036" points="1206,2320.7188,1196,2324.7188,1206,2328.7188,1202,2324.7188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1200" x2="1463" y1="2324.7188" y2="2324.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1212" y="2319.6528">65</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="1234" y="2319.6528">Write(number)</text><polygon fill="#A80036" points="951,2349.8516,941,2353.8516,951,2357.8516,947,2353.8516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="945" x2="1184" y1="2353.8516" y2="2353.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="957" y="2348.7856">66</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="983" y="2348.7856"/><polygon fill="#A80036" points="704,2378.9844,694,2382.9844,704,2386.9844,700,2382.9844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="698" x2="929" y1="2382.9844" y2="2382.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="710" y="2377.9185">67</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="736" y="2377.9185"/><polygon fill="#A80036" points="1475,2408.1172,1465,2412.1172,1475,2416.1172,1471,2412.1172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1469" x2="2271" y1="2412.1172" y2="2412.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1481" y="2407.0513">68</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="1503" y="2407.0513">WriteString(data)</text><polygon fill="#A80036" points="1206,2437.25,1196,2441.25,1206,2445.25,1202,2441.25" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1200" x2="1463" y1="2441.25" y2="2441.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1212" y="2436.1841">69</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="1234" y="2436.1841">Write(encodedData)</text><polygon fill="#A80036" points="951,2466.3828,941,2470.3828,951,2474.3828,947,2470.3828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="945" x2="1184" y1="2470.3828" y2="2470.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="957" y="2465.3169">70</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="983" y="2465.3169"/><polygon fill="#A80036" points="704,2495.5156,694,2499.5156,704,2503.5156,700,2499.5156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="698" x2="929" y1="2499.5156" y2="2499.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="710" y="2494.4497">71</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="736" y="2494.4497"/><polygon fill="#A80036" points="93.5,2524.6484,83.5,2528.6484,93.5,2532.6484,89.5,2528.6484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="87.5" x2="682" y1="2528.6484" y2="2528.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="99.5" y="2523.5825">72</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="121.5" y="2523.5825">message : string</text><line style="stroke:#A80036;stroke-width:1.0;" x1="82.5" x2="124.5" y1="2562.7813" y2="2562.7813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="124.5" x2="124.5" y1="2562.7813" y2="2575.7813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="77.5" x2="124.5" y1="2575.7813" y2="2575.7813"/><polygon fill="#A80036" points="87.5,2571.7813,77.5,2575.7813,87.5,2579.7813,83.5,2575.7813" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="89.5" y="2557.7153">73</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="111.5" y="2557.7153">ShowGameInfo(gameId)</text><path d="M277,2543.1484 L277,2568.1484 L521,2568.1484 L521,2553.1484 L511,2543.1484 L277,2543.1484 " fill="#FBFB77" filter="url(#f171c6zi8kskl4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M511,2543.1484 L511,2553.1484 L521,2553.1484 L511,2543.1484 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="283" y="2560.2153">Se imprime el mensaje en pantalla</text><!--MD5=[05589468d0126e005b26ea8b82d8f15a]
@startuml
/'!theme metal'/
Participant ClientPresentation #LightBlue
Participant CommandFactoryC #LightBlue
Participant BuyGameC #LightBlue
Participant NetworkStreamHandlerC #LightBlue
Participant NetworkStream #LightYellow
Participant NetworkStreamHandlerS #LightGreen
Participant ClientHandler #LightGreen
Participant CommandFactoryS #LightGreen
Participant BuyGameS #LightGreen
Participant BusinessLogicGameInfo #LightGreen
Participant BusinessLogicUtils #LightGreen
database DataAccess #LightGreen

ClientPresentation -> NetworkStreamHandlerC : new NetworkStreamHandler(tcpClient.GetStream()); : void
activate NetworkStreamHandlerC
activate ClientPresentation
activate ClientHandler
activate NetworkStream #Yellow
activate DataAccess


ClientHandler -> NetworkStreamHandlerS : ReadCommand() : Command 
NetworkStreamHandlerS -> NetworkStream : Read(CMD_LENGTH) : byte[]
note right
Esto se realiza cuando 
se crea la conexión con el cliente
end note

autonumber
ClientPresentation -> ClientPresentation : BuyGame(gameId) : void


ClientHandler -> NetworkStreamHandlerS : ReadHeader() : string
NetworkStreamHandlerS -> NetworkStream : Read(HEADER_LENGTH) : byte[]

ClientPresentation -> CommandFactoryC : GetCommandHandler(BUY_GAME, nwsh) : BuyGameC
activate CommandFactoryC
create BuyGameC
CommandFactoryC -> BuyGameC :  new BuyGame(nwsh)
return new BuyGameC()
deactivate CommandFactoryC

ClientPresentation -> BuyGameC : SendRequest() : GamePage
activate BuyGameC

BuyGameC -> NetworkStreamHandlerC : WriteString(REQUEST_HEADER)
NetworkStreamHandlerC -> NetworkStream : Write(REQUEST_HEADER: byte[])
NetworkStream - -> NetworkStreamHandlerS : byte[HEADER_LENGTH]
NetworkStreamHandlerS - -> ClientHandler : "REQ"


BuyGameC -> NetworkStreamHandlerC : WriteCommand(BUY_GAME)
NetworkStreamHandlerC -> NetworkStream : Write(data : byte[])
NetworkStream - -> NetworkStreamHandlerS : byte[CMD_LENGTH]
NetworkStreamHandlerS - -> ClientHandler : BUY_GAME

BuyGameC -> NetworkStreamHandlerC : WriteInt(dataLengthInBytes)
NetworkStreamHandlerC -> NetworkStream : Write(data : byte[])

BuyGameC -> NetworkStreamHandlerC : WriteString(data)
NetworkStreamHandlerC -> NetworkStream : Write(data : byte[])
note left
  El cliente manda la solicitud y 
  espera leyendo la respuesta
end note


BuyGameC -> NetworkStreamHandlerC : ReadInt(HEADER_LENGTH)
NetworkStreamHandlerC -> NetworkStream : Read(HEADER_LENGTH)

BuyGameC -> NetworkStreamHandlerC : ReadCommand()
NetworkStreamHandlerC -> NetworkStream : Read(CMD_LENGTH)

BuyGameC -> NetworkStreamHandlerC : ReadInt(DATA_SIZE_LENGTH)
NetworkStreamHandlerC -> NetworkStream : Read(DATA_SIZE_LENGTH)

BuyGameC -> NetworkStreamHandlerC : ReadString(dataLength)
NetworkStreamHandlerC -> NetworkStream : Read(dataLength)

/' server  '/

ClientHandler -> CommandFactoryS : GetCommandHandler(BUY_GAME, nwsh) : BuyGameC
activate CommandFactoryS
create BuyGameS
CommandFactoryS -> BuyGameS :  new BuyGame()
activate BuyGameS
return BuyGameS
ClientHandler -> BuyGameS : HandleRequest()
deactivate CommandFactoryS
activate BuyGameS

BuyGameS -> NetworkStreamHandlerS : ReadInt(DATA_SIZE_LENGTH)
NetworkStreamHandlerS -> NetworkStream : Read(DATA_SIZE_LENGTH) : byte[]
NetworkStream - -> NetworkStreamHandlerS
NetworkStreamHandlerS - -> BuyGameS

BuyGameS -> NetworkStreamHandlerS : ReadString(length)
NetworkStreamHandlerS -> NetworkStream : Read(length) : byte[]
NetworkStream -> NetworkStreamHandlerS
NetworkStreamHandlerS - -> BuyGameS

/' singleton'/
BuyGameS -> BusinessLogicGameInfo : << static >> GetInstance() 
note right
  BusinessLogicGameInfo
  singleton
end note
activate BusinessLogicGameInfo
alt instance == null
  BusinessLogicGameInfo -> BusinessLogicGameInfo : new BusinessLogicGameInfo()
end
BusinessLogicGameInfo - -> BuyGameS 
BuyGameS -> BusinessLogicGameInfo : BuyGame(gameId,nwsh)

/' singleton'/
BusinessLogicGameInfo -> BusinessLogicUtils : << static >> GetInstance() 
note right
  BusinessLogicUtils
  singleton
end note
activate BusinessLogicUtils
alt instance == null
  BusinessLogicUtils -> BusinessLogicUtils : new BusinessLogicGameInfo()
end
BusinessLogicUtils - -> BusinessLogicGameInfo 
BusinessLogicGameInfo -> BusinessLogicUtils : GetGameById(gameId) : Game
BusinessLogicUtils -> DataAccess : Games.Find(game.Id == gameId) : Game
DataAccess - -> BusinessLogicUtils
BusinessLogicUtils - -> BusinessLogicGameInfo
note right
El dataAcces también cuenta con un singleton
Asi todas las businesss logic acceden al mismo
Se sacó del diagrama para no agrandarlo más
end note

BusinessLogicGameInfo -> BusinessLogicUtils : GetUser(nwsh) : User
BusinessLogicUtils -> DataAccess : users.Find(game.Id == username) : User
DataAccess - -> BusinessLogicUtils
BusinessLogicUtils - -> BusinessLogicGameInfo 



BusinessLogicGameInfo - -> BuyGameS : success : bool

BuyGameS -> NetworkStreamHandlerS : WriteString(RESPONSE_HEADER)
NetworkStreamHandlerS -> NetworkStream : Write(encodedData)
NetworkStream - -> NetworkStreamHandlerC 
NetworkStreamHandlerC - -> BuyGameC 

BuyGameS -> NetworkStreamHandlerS : WriteCommand(BUY_GAME)
NetworkStreamHandlerS -> NetworkStream : Write(cmd)
NetworkStream - -> NetworkStreamHandlerC 
NetworkStreamHandlerC - -> BuyGameC 

BuyGameS -> NetworkStreamHandlerS : WriteInt(dataLengthInBytes)
NetworkStreamHandlerS -> NetworkStream : Write(number)
NetworkStream - -> NetworkStreamHandlerC 
NetworkStreamHandlerC - -> BuyGameC 

BuyGameS -> NetworkStreamHandlerS : WriteString(data)
NetworkStreamHandlerS -> NetworkStream : Write(encodedData)
NetworkStream - -> NetworkStreamHandlerC 
NetworkStreamHandlerC - -> BuyGameC 

BuyGameC - -> ClientPresentation : message : string
ClientPresentation -> ClientPresentation : ShowGameInfo(gameId)
note right
Se imprime el mensaje en pantalla
end note
deactivate NetworkStream
@enduml

@startuml
Participant ClientPresentation #LightBlue
Participant CommandFactoryC #LightBlue
Participant BuyGameC #LightBlue
Participant NetworkStreamHandlerC #LightBlue
Participant NetworkStream #LightYellow
Participant NetworkStreamHandlerS #LightGreen
Participant ClientHandler #LightGreen
Participant CommandFactoryS #LightGreen
Participant BuyGameS #LightGreen
Participant BusinessLogicGameInfo #LightGreen
Participant BusinessLogicUtils #LightGreen
database DataAccess #LightGreen

ClientPresentation -> NetworkStreamHandlerC : new NetworkStreamHandler(tcpClient.GetStream()); : void
activate NetworkStreamHandlerC
activate ClientPresentation
activate ClientHandler
activate NetworkStream #Yellow
activate DataAccess


ClientHandler -> NetworkStreamHandlerS : ReadCommand() : Command 
NetworkStreamHandlerS -> NetworkStream : Read(CMD_LENGTH) : byte[]
note right
Esto se realiza cuando 
se crea la conexión con el cliente
end note

autonumber
ClientPresentation -> ClientPresentation : BuyGame(gameId) : void


ClientHandler -> NetworkStreamHandlerS : ReadHeader() : string
NetworkStreamHandlerS -> NetworkStream : Read(HEADER_LENGTH) : byte[]

ClientPresentation -> CommandFactoryC : GetCommandHandler(BUY_GAME, nwsh) : BuyGameC
activate CommandFactoryC
create BuyGameC
CommandFactoryC -> BuyGameC :  new BuyGame(nwsh)
return new BuyGameC()
deactivate CommandFactoryC

ClientPresentation -> BuyGameC : SendRequest() : GamePage
activate BuyGameC

BuyGameC -> NetworkStreamHandlerC : WriteString(REQUEST_HEADER)
NetworkStreamHandlerC -> NetworkStream : Write(REQUEST_HEADER: byte[])
NetworkStream - -> NetworkStreamHandlerS : byte[HEADER_LENGTH]
NetworkStreamHandlerS - -> ClientHandler : "REQ"


BuyGameC -> NetworkStreamHandlerC : WriteCommand(BUY_GAME)
NetworkStreamHandlerC -> NetworkStream : Write(data : byte[])
NetworkStream - -> NetworkStreamHandlerS : byte[CMD_LENGTH]
NetworkStreamHandlerS - -> ClientHandler : BUY_GAME

BuyGameC -> NetworkStreamHandlerC : WriteInt(dataLengthInBytes)
NetworkStreamHandlerC -> NetworkStream : Write(data : byte[])

BuyGameC -> NetworkStreamHandlerC : WriteString(data)
NetworkStreamHandlerC -> NetworkStream : Write(data : byte[])
note left
  El cliente manda la solicitud y 
  espera leyendo la respuesta
end note


BuyGameC -> NetworkStreamHandlerC : ReadInt(HEADER_LENGTH)
NetworkStreamHandlerC -> NetworkStream : Read(HEADER_LENGTH)

BuyGameC -> NetworkStreamHandlerC : ReadCommand()
NetworkStreamHandlerC -> NetworkStream : Read(CMD_LENGTH)

BuyGameC -> NetworkStreamHandlerC : ReadInt(DATA_SIZE_LENGTH)
NetworkStreamHandlerC -> NetworkStream : Read(DATA_SIZE_LENGTH)

BuyGameC -> NetworkStreamHandlerC : ReadString(dataLength)
NetworkStreamHandlerC -> NetworkStream : Read(dataLength)


ClientHandler -> CommandFactoryS : GetCommandHandler(BUY_GAME, nwsh) : BuyGameC
activate CommandFactoryS
create BuyGameS
CommandFactoryS -> BuyGameS :  new BuyGame()
activate BuyGameS
return BuyGameS
ClientHandler -> BuyGameS : HandleRequest()
deactivate CommandFactoryS
activate BuyGameS

BuyGameS -> NetworkStreamHandlerS : ReadInt(DATA_SIZE_LENGTH)
NetworkStreamHandlerS -> NetworkStream : Read(DATA_SIZE_LENGTH) : byte[]
NetworkStream - -> NetworkStreamHandlerS
NetworkStreamHandlerS - -> BuyGameS

BuyGameS -> NetworkStreamHandlerS : ReadString(length)
NetworkStreamHandlerS -> NetworkStream : Read(length) : byte[]
NetworkStream -> NetworkStreamHandlerS
NetworkStreamHandlerS - -> BuyGameS

BuyGameS -> BusinessLogicGameInfo : << static >> GetInstance() 
note right
  BusinessLogicGameInfo
  singleton
end note
activate BusinessLogicGameInfo
alt instance == null
  BusinessLogicGameInfo -> BusinessLogicGameInfo : new BusinessLogicGameInfo()
end
BusinessLogicGameInfo - -> BuyGameS 
BuyGameS -> BusinessLogicGameInfo : BuyGame(gameId,nwsh)

BusinessLogicGameInfo -> BusinessLogicUtils : << static >> GetInstance() 
note right
  BusinessLogicUtils
  singleton
end note
activate BusinessLogicUtils
alt instance == null
  BusinessLogicUtils -> BusinessLogicUtils : new BusinessLogicGameInfo()
end
BusinessLogicUtils - -> BusinessLogicGameInfo 
BusinessLogicGameInfo -> BusinessLogicUtils : GetGameById(gameId) : Game
BusinessLogicUtils -> DataAccess : Games.Find(game.Id == gameId) : Game
DataAccess - -> BusinessLogicUtils
BusinessLogicUtils - -> BusinessLogicGameInfo
note right
El dataAcces también cuenta con un singleton
Asi todas las businesss logic acceden al mismo
Se sacó del diagrama para no agrandarlo más
end note

BusinessLogicGameInfo -> BusinessLogicUtils : GetUser(nwsh) : User
BusinessLogicUtils -> DataAccess : users.Find(game.Id == username) : User
DataAccess - -> BusinessLogicUtils
BusinessLogicUtils - -> BusinessLogicGameInfo 



BusinessLogicGameInfo - -> BuyGameS : success : bool

BuyGameS -> NetworkStreamHandlerS : WriteString(RESPONSE_HEADER)
NetworkStreamHandlerS -> NetworkStream : Write(encodedData)
NetworkStream - -> NetworkStreamHandlerC 
NetworkStreamHandlerC - -> BuyGameC 

BuyGameS -> NetworkStreamHandlerS : WriteCommand(BUY_GAME)
NetworkStreamHandlerS -> NetworkStream : Write(cmd)
NetworkStream - -> NetworkStreamHandlerC 
NetworkStreamHandlerC - -> BuyGameC 

BuyGameS -> NetworkStreamHandlerS : WriteInt(dataLengthInBytes)
NetworkStreamHandlerS -> NetworkStream : Write(number)
NetworkStream - -> NetworkStreamHandlerC 
NetworkStreamHandlerC - -> BuyGameC 

BuyGameS -> NetworkStreamHandlerS : WriteString(data)
NetworkStreamHandlerS -> NetworkStream : Write(encodedData)
NetworkStream - -> NetworkStreamHandlerC 
NetworkStreamHandlerC - -> BuyGameC 

BuyGameC - -> ClientPresentation : message : string
ClientPresentation -> ClientPresentation : ShowGameInfo(gameId)
note right
Se imprime el mensaje en pantalla
end note
deactivate NetworkStream
@enduml

PlantUML version 1.2021.7(Sun May 23 12:40:07 UTC 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>